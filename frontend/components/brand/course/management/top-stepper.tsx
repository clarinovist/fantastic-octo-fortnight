import { Button } from "@/components/ui/button"
import Link from "next/link"

type TopStepperProps = {
  steps: string[]
  currentStep: number // 0-based index
  onSubmit?: () => void
  isSubmitting?: boolean
  isDisabled?: boolean
}

export function TopStepper({
  steps,
  currentStep,
  onSubmit,
  isSubmitting,
  isDisabled,
}: TopStepperProps) {
  return (
    <div>
      <div className="p-4 gap-4 flex xl:flex-nowrap flex-wrap justify-end items-start xl:rounded-full rounded-lg mb-2 shadow-[0px_4px_8px_0px_rgba(0,0,0,0.25)]">
        <div className="relative flex items-center justify-between w-full">
          {steps.map((_, index) => {
            const widthStep = ((steps.length - 1) / 100) * 100
            const isActive = index === currentStep
            const isLast = index === steps.length - 1
            const classWidthStep = isLast ? "w-fit" : `w-[${widthStep}%] flex-1`

            return (
              <div key={index} className={classWidthStep}>
                <div className="relative w-full">
                  {/* Connector line (only between steps) */}
                  {!isLast && (
                    <div className="absolute w-full top-[25%] left-1">
                      <div
                        className={`h-4 ${index < currentStep ? "bg-main" : "bg-[#BABABABA]"} w-full`}
                      />
                    </div>
                  )}

                  <div className="relative w-fit">
                    {/* White circle */}
                    <div
                      className={
                        isActive
                          ? "w-8 h-8"
                          : "w-8 h-8 rounded-full bg-white border-4 border-main flex items-center justify-center z-10 relative"
                      }
                    />
                  </div>

                  {isActive && (
                    <div className="absolute z-20 top-[-15px] left-[-15px] bg-transparent w-fit">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="63"
                        height="63"
                        viewBox="0 0 63 63"
                        fill="none"
                      >
                        <g filter="url(#filter0_d_1016_45069)">
                          <path
                            d="M13.1728 36.7615C12.9509 33.9267 10.9251 24.274 9.98849 21.5891C8.69886 16.4943 10.3252 15.0956 11.2996 15.0331C10.5504 11.4367 12.2362 10.2878 13.1728 10.1629C12.2737 7.46562 13.922 6.29185 14.8586 6.04213C14.2967 4.169 14.7462 0.759895 21.0399 2.10855C28.9071 3.79437 33.9646 4.169 37.1489 4.35631C39.6963 4.50616 40.8327 6.79139 41.0825 7.91527L42.3937 13.3474C43.0805 13.3474 44.5665 13.7969 45.016 15.5951C45.4656 17.3933 44.4541 18.2175 43.8922 18.4048C44.6414 22.276 46.2523 30.8799 46.7019 34.3265C47.1514 37.773 44.7663 39.3839 43.5175 39.7585L46.1399 42.9429C46.7019 42.2561 48.9871 40.9948 53.6325 41.4444C58.2778 41.8939 57.0665 44.8784 55.8802 46.3145C54.2568 48.5623 50.3357 53.6946 47.6384 56.2421C44.9411 58.7896 41.5195 57.1787 40.1459 56.0548C37.7483 53.9569 34.027 51.4344 32.4661 50.4354C30.031 53.0578 27.4086 54.369 23.6623 54.7436C20.6653 55.0433 17.918 53.7446 16.919 53.0578C16.3571 53.6197 14.8211 54.9309 13.1728 55.6802C11.1124 56.6167 8.48999 56.8041 7.17879 55.3055C6.12984 54.1067 6.74173 51.3095 7.17879 50.0608C8.05292 47.1262 9.98849 40.8075 10.7377 39.0093C11.487 37.2111 12.6733 36.7615 13.1728 36.7615Z"
                            fill="white"
                          />
                        </g>
                        <path
                          fillRule="evenodd"
                          clipRule="evenodd"
                          d="M32.7638 8.2904C27.011 8.47476 21.7612 8.2904 16.9756 7.40221C15.6441 7.15515 15.1679 8.27921 15.2097 8.95917C15.2112 8.9823 15.2127 9.00395 15.2135 9.02559C15.2732 9.72645 15.6493 10.3064 16.136 10.2422C16.4606 10.1997 16.8263 10.0511 16.8263 9.38311C16.8263 9.31445 16.8263 9.24578 16.8256 9.17636C16.8241 8.84795 16.992 8.76361 17.2323 8.76958C20.8588 8.86064 24.4853 8.94349 28.1118 9.03007C23.8741 10.3079 19.3923 11.4648 14.9269 11.4961C14.0656 11.5021 13.2416 12.3634 13.367 13.7099C13.4021 14.0861 13.417 14.3055 13.4319 14.5421C13.4596 14.9683 13.5752 15.1848 14.0029 14.975H14.0036C14.4686 14.7459 14.8687 13.898 14.9649 13.3822C15.0112 13.1367 15.0829 13.018 15.3299 12.965C21.1596 11.7126 27.0237 9.99142 32.8519 8.73152C33.2392 8.64494 33.2609 8.30683 32.7638 8.28891V8.2904ZM37.8987 18.3815C37.7278 18.4368 37.6807 18.5017 37.7942 18.6831L37.8024 18.6965L37.8039 18.6987C38.5741 19.9146 39.0197 21.3559 39.0197 22.9016C39.0197 27.2464 35.4977 30.7693 31.1524 30.7693C27.4379 30.7693 24.3249 28.1943 23.5002 24.7318C23.4628 24.5661 23.4009 24.5482 23.2352 24.6034C22.3515 24.8982 21.4708 25.208 20.5872 25.4894C20.3274 25.5722 20.2446 25.829 20.3446 26.1238L20.5872 26.8441C20.9611 27.8823 20.5222 28.4854 19.5199 28.9653C19.146 29.1287 19.0071 29.0698 18.9146 28.8369L18.4384 27.6382C18.3504 27.4218 18.2601 27.206 18.1735 26.9888C17.6182 25.6088 18.3765 24.2854 19.5721 23.8705C20.8655 23.4211 21.9134 23.0957 22.9986 22.7621C23.2136 22.6964 23.2889 22.5911 23.3016 22.4299C23.3016 22.424 23.3024 22.4187 23.3024 22.4128C23.3024 22.406 23.3031 22.3986 23.3031 22.3919L23.3039 22.3926C23.5666 18.2853 26.9804 15.0347 31.1539 15.0347C33.0362 15.0347 34.7648 15.6968 36.1186 16.7992L36.1246 16.8037L36.1395 16.8156C36.3015 16.9447 36.4149 16.9574 36.6097 16.9029L38.9727 16.2372C39.0772 16.2081 39.0913 16.1588 39.0615 16.0342C38.7555 14.769 38.498 13.7174 38.198 12.5455C38.1621 12.4075 38.0696 12.3642 37.9241 12.3813C32.366 13.1561 22.7575 14.9877 14.9478 18.1181C14.7276 18.2136 14.5104 18.3091 14.2962 18.4062C13.8447 18.6092 13.6887 18.6002 13.8872 19.4153C15.4359 25.7745 17.2599 31.9993 18.7571 38.3705C18.9952 39.3826 17.001 39.7364 16.7196 37.8592C15.8023 31.7418 14.9157 26.1902 12.2423 19.6788C12.0519 19.2145 12.031 18.8182 12.0482 18.4718C12.1012 17.3985 13.014 16.8007 14.4059 16.1275C20.1692 13.3412 27.6655 11.0177 35.897 9.39431C37.4076 9.09874 37.0008 7.87989 35.7694 7.71046C30.3188 6.86779 24.8734 5.99005 19.4176 5.18246C19.0758 5.1317 18.8594 5.31158 18.8444 5.68403L18.8429 5.72732C18.8131 6.39981 18.5892 6.52968 18.3466 6.52073H18.3459C18.0936 6.51177 17.4212 6.11992 17.4025 5.20485C17.4032 5.16902 17.4032 5.13245 17.4032 5.09662C17.4047 4.17708 17.9309 3.79343 18.7915 3.79493C18.9654 3.79567 19.1243 3.79791 19.3243 3.84195C25.0869 5.10707 30.6121 6.14455 36.1089 6.39309C38.4943 6.50132 38.8294 7.44699 39.1406 8.54268C39.7966 10.8542 40.3736 13.1576 40.9535 15.4833C40.9886 15.6229 41.0318 15.655 41.1856 15.6117C42.6156 15.2087 42.9731 16.7641 41.6692 17.1791L41.5685 17.2112C41.4483 17.25 41.4035 17.3284 41.4393 17.4784C42.7395 22.983 43.7299 28.56 44.3874 34.2131C44.6404 37.0733 42.8096 38.1197 40.7221 38.8235C40.4945 38.8982 40.4698 39.0698 40.6393 39.2855C42.2917 41.3821 44.0956 43.5205 45.7405 45.6149C45.8577 45.7649 45.9741 45.7754 46.1294 45.6664C48.3341 44.1326 50.6119 43.2757 52.9734 43.2018C53.8287 43.1929 54.7355 43.4287 54.7557 44.09C54.7646 44.3916 54.5892 44.7827 54.1392 45.2783C51.4777 48.2877 48.7438 51.2344 46.1555 54.3073C45.1927 55.45 44.2523 55.9352 43.0955 54.9999C39.2331 51.8778 35.2424 49.0415 31.0151 46.6658C29.197 51.4979 23.2098 53.9781 17.098 49.9283C16.7308 49.6849 16.4308 49.6797 16.186 49.876C14.3649 51.3397 13.6088 51.9651 11.6347 52.9519C11.2563 53.1459 10.9362 53.2489 10.66 53.2452C10.1226 53.2385 9.792 52.8675 9.80096 52.2592C9.80618 51.9136 9.91291 51.486 10.1495 50.9971C11.6176 47.7831 11.984 45.0984 13.3715 41.8486C13.9671 40.4536 14.8381 40.067 16.3681 40.9104C17.7891 41.6941 19.3303 42.4726 20.4857 41.1187C21.6582 39.7453 23.4957 40.5231 22.4142 42.2651C21.0215 44.5088 18.3936 44.1908 15.0366 42.4748C14.9112 42.4099 14.8194 42.4316 14.7522 42.5689L14.7545 42.5264C14.1626 43.7527 13.7559 44.9014 13.3797 46.0373C13.308 46.256 13.3633 46.3964 13.6581 46.1807C15.8777 44.6021 17.1853 44.7946 18.1906 45.9052C21.8097 50.4089 30.0314 47.0218 29.6799 41.5964C29.6672 41.4463 29.6523 41.2963 29.6329 41.1448C29.4224 39.8633 30.9703 39.8364 31.2487 41.0142C31.3771 41.5128 31.4659 42.0046 31.5182 42.4883L31.5189 42.4965L31.5196 42.5017C31.5443 42.7219 31.6406 42.8891 31.8809 43.0085C37.0187 45.5671 41.6103 48.5295 45.8697 51.739C46.0316 51.8614 46.113 51.8614 46.2578 51.7039C48.2393 49.5476 50.3679 47.2801 52.2853 45.1939C52.4106 45.0573 52.3076 44.9842 52.1412 44.9864C50.2492 45.0827 48.2542 46.3717 46.3749 47.5801C45.6152 47.9727 45.0942 47.8115 44.5188 47.1733C42.8081 45.0827 40.593 41.8501 38.8824 39.7588C38.0457 38.7161 37.8979 37.8331 39.8743 37.3009C41.0259 36.9904 42.6566 35.935 42.4977 34.5199C41.9058 29.2467 40.8736 23.7622 39.5354 18.0225C39.5108 17.9247 39.4279 17.8949 39.3145 17.9307L37.9009 18.3808L37.8987 18.3815ZM31.1532 16.6954C34.5804 16.6954 37.3591 19.4742 37.3591 22.9016C37.3591 26.329 34.5804 29.1078 31.1532 29.1078C27.726 29.1078 24.9473 26.329 24.9473 22.9016C24.9473 19.4742 27.726 16.6954 31.1532 16.6954Z"
                          fill="#7000FE"
                        />
                        <defs>
                          <filter
                            id="filter0_d_1016_45069"
                            x="-1.40039"
                            y="-2.19922"
                            width="66.3613"
                            height="71.8008"
                            filterUnits="userSpaceOnUse"
                            colorInterpolationFilters="sRGB"
                          >
                            <feFlood floodOpacity="0" result="BackgroundImageFix" />
                            <feColorMatrix
                              in="SourceAlpha"
                              type="matrix"
                              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                              result="hardAlpha"
                            />
                            <feOffset dy="4" />
                            <feGaussianBlur stdDeviation="4" />
                            <feComposite in2="hardAlpha" operator="out" />
                            <feColorMatrix
                              type="matrix"
                              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                            />
                            <feBlend
                              mode="normal"
                              in2="BackgroundImageFix"
                              result="effect1_dropShadow_1016_45069"
                            />
                            <feBlend
                              mode="normal"
                              in="SourceGraphic"
                              in2="effect1_dropShadow_1016_45069"
                              result="shape"
                            />
                          </filter>
                        </defs>
                      </svg>
                    </div>
                  )}
                </div>
              </div>
            )
          })}
        </div>
        <div className="flex items-center gap-4">
          <Button
            className={`px-8 rounded-full transition-all duration-200 ${
              isDisabled || isSubmitting
                ? "bg-gray-400 cursor-not-allowed hover:bg-gray-400"
                : "bg-main hover:bg-main-dark"
            }`}
            onClick={onSubmit}
            disabled={isDisabled || isSubmitting}
          >
            {isSubmitting ? "Submitting..." : "Done"}
          </Button>
          <Link href="/">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="24"
              viewBox="0 0 22 24"
              fill="none"
            >
              <path
                d="M2.75 21.2571H6.875V14.4C6.875 14.0114 7.007 13.6859 7.271 13.4235C7.535 13.1611 7.86133 13.0295 8.25 13.0286H13.75C14.1396 13.0286 14.4664 13.1602 14.7304 13.4235C14.9944 13.6869 15.1259 14.0123 15.125 14.4V21.2571H19.25V8.91428L11 2.74286L2.75 8.91428V21.2571ZM0 21.2571V8.91428C0 8.48 0.0976247 8.06857 0.292875 7.68C0.488125 7.29143 0.757167 6.97143 1.1 6.72L9.35 0.548571C9.83125 0.182857 10.3812 0 11 0C11.6187 0 12.1687 0.182857 12.65 0.548571L20.9 6.72C21.2437 6.97143 21.5132 7.29143 21.7085 7.68C21.9037 8.06857 22.0009 8.48 22 8.91428V21.2571C22 22.0114 21.7305 22.6574 21.1915 23.195C20.6525 23.7326 20.0053 24.0009 19.25 24H13.75C13.3604 24 13.0341 23.8683 12.771 23.605C12.5079 23.3417 12.3759 23.0162 12.375 22.6286V15.7714H9.625V22.6286C9.625 23.0171 9.493 23.3431 9.229 23.6064C8.965 23.8697 8.63866 24.0009 8.25 24H2.75C1.99375 24 1.34658 23.7317 0.8085 23.195C0.270416 22.6583 0.000916666 22.0123 0 21.2571Z"
                fill="#7000FE"
              />
            </svg>
          </Link>
        </div>
      </div>
      <div className="xl:block hidden">
        <div className="w-[calc(100%-125px)] flex justify-between px-4">
          {steps.map((step, index) => {
            return (
              <div key={index} className="max-w-[150px] leading-1">
                <span className="text-xs text-center text-main font-bold">{step}</span>
              </div>
            )
          })}
        </div>
      </div>
    </div>
  )
}
